# SwarmTorch v0.1.0-alpha.6x Release Notes

**Date:** 2026-02-13  
**Type:** DataOps descriptor hardening + unsafe-cause explainability  
**Builds on:** `v0.1.0-alpha.6`

## Summary

This increment closes a release-note coverage gap for A6X-04 and documents the shipped implementation:

- source descriptor sanitization/redaction before persistence and fingerprinting
- bounded descriptor metadata sizes (URI and etag/version)
- explicit `unsafe_reasons[]` taxonomy in `MaterializationRecordV2`
- timeline/report rendering of unsafe reasons for operator visibility
- no_std/alloc MSRV fix discovered during gate run (`alloc::vec` import for `vec![]`)

## Gap Sweep Findings and Closure

### Missing log identified

- Commit `30b93d4` (`feat(dataops): enforce descriptor sanitization and unsafe reason rendering`) was code-complete but had no dedicated release-note entry.

### Closure action

- Added this file and indexed it in `docs/release_notes/README.md`.

## Key Changes

### 1. Source Descriptor Sanitization and Bounds

**File:** `swarm-torch-core/src/dataops.rs`

- Added bounds:
  - `MAX_SOURCE_URI_LEN = 2048`
  - `MAX_ETAG_OR_VERSION_LEN = 512`
- Added `SourceDescriptorError::{UriTooLong, EtagOrVersionTooLong}`.
- Added `sanitize_source_descriptor_v0(...)`:
  - redacts URI userinfo (`user[:pass]@` -> `<redacted>@`)
  - normalizes descriptor fields for canonical hashing
  - rejects over-limit values
- Updated `source_fingerprint_v0(...)` to hash sanitized/normalized descriptor form.

### 2. Unsafe Reason Taxonomy in Materialization v2

**Files:** `swarm-torch-core/src/dataops.rs`, `swarm-torch/src/artifacts.rs`

- Added `UnsafeReasonV0`:
  - `UntrustedInput`
  - `UnsafeExtension`
  - `MissingProvenance`
- Extended `MaterializationRecordV2`:
  - `unsafe_reasons: Vec<UnsafeReasonV0>` with serde default/skip-empty compatibility behavior.
- V1 compatibility normalization now marks missing provenance explicitly:
  - `unsafe_surface = true`
  - `unsafe_reasons = [MissingProvenance]`
- `DataOpsSession::materialize_node_outputs(...)` now derives:
  - `unsafe_reasons` from trust inputs and execution trust
  - `unsafe_surface = !unsafe_reasons.is_empty()`

### 3. Writer Enforcement

**File:** `swarm-torch/src/artifacts.rs`

- `DataOpsSession::register_source(...)` now sanitizes descriptor input before hashing/writing.
- Descriptor violations map to `io::ErrorKind::InvalidInput`.
- Persisted descriptor data is sanitized (credentials never persisted in URI authority userinfo form).

### 4. Report and Timeline Unsafe Reason Rendering

**File:** `swarm-torch/src/report.rs`

- Added rendering helpers:
  - `unsafe_reason_label(...)`
  - `format_unsafe_reasons(...)`
- Timeline materialization details now include:
  - `unsafe_reasons=...` (or `unsafe_reasons=none`)
- Unsafe warning banner now includes reason labels per unsafe materialization.

### 5. MSRV/no_std Alloc Fix

**File:** `swarm-torch-core/src/dataops.rs`

- Added `use alloc::vec;` to support `vec![]` in `no_std + alloc` builds.
- This was required after introducing V1 compatibility reason mapping with `vec![...]`.

### 6. Canon Docs Alignment

**Files:** `readme.md`, `docs/release_notes/M4-02.5_replay_protection_hardening.md`, `docs/release_notes/M4-02_replay_protection_enforcement.md`

- Clarified embedded status wording to match current implementation reality:
  - `embedded_alloc`: experimental
  - `embedded_min`: planned
- Added explicit M4-02.5 audit caveat:
  - `ReplayProtection::with_config(...)` keeps panic-on-zero behavior for compatibility.
- Marked M4-02 whitepaper follow-up text as completed to avoid stale "update required" drift.

## Tests Added/Updated

### Core (`swarm-torch-core/src/dataops.rs`)

- `source_descriptor_redacts_userinfo_in_uri`
- `source_descriptor_rejects_oversized_uri`
- `source_descriptor_rejects_oversized_etag_or_version`
- `unsafe_reasons_include_missing_provenance`

### Artifacts (`swarm-torch/src/artifacts.rs`)

- `unsafe_reasons_include_untrusted_input`
- `unsafe_reasons_include_unsafe_extension`
- `source_descriptor_rejects_oversized_uri`
- `source_descriptor_rejects_oversized_etag_or_version`

### Report (`swarm-torch/src/report.rs`)

- `timeline_materialization_includes_unsafe_reasons_when_present`
- `report_warning_lists_unsafe_materialization_reasons`
- `timeline_materialization_includes_node_id_and_node_def_hash` (updated assertion for `unsafe_reasons=none`)

## Verification

```bash
cargo fmt --all -- --check
cargo test -p swarm-torch-core dataops::tests::source_descriptor
cargo test -p swarm-torch unsafe_reasons
cargo test --workspace
cargo clippy --workspace --all-targets --all-features -- -D warnings
cargo +1.75 build -p swarm-torch-core --no-default-features --features alloc
```

All commands passed after the `alloc::vec` no_std fix.

## Compatibility and Behavior Notes

- No wire-format break introduced (`unsafe_reasons` is additive and serde-defaulted).
- Existing materialization readers remain compatible via `MaterializationRecordCompat`.
- Node-level unsafe rendering in reports remains derived from `is_node_unsafe(...)`; reason lists augment materialization observability.
